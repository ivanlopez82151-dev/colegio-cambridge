{% extends 'colegio/base.html' %}
{% load static %}

{% block title %}Reporte de Áreas y Empleados - Sistema de Gestión{% endblock %}

{% block content %}
<h2>Reporte de Áreas y Empleados</h2>
<div class="actions-bar">
    <a href="{% url 'area-list' %}" class="btn btn-primary">Volver a Áreas</a>
    <a href="#" class="btn btn-secondary" onclick="window.print()">Imprimir Reporte</a>
    <a href="{% url 'exportar-reporte-pdf' %}" class="btn btn-danger">Exportar a PDF</a>
</div>

<div class="summary-card">
    <h3>Resumen General</h3>
    <div class="summary-grid">
        <div class="summary-item">
            <h4>Total de Áreas</h4>
            <p>{{ areas|length }}</p>
        </div>
        <div class="summary-item">
            <h4>Total de Empleados</h4>
            <p>{{ total_empleados }}</p>
        </div>
        <div class="summary-item">
            <h4>Total de Profesores</h4>
            <p>{{ total_profesores }}</p>
        </div>
        <div class="summary-item">
            <h4>Total de Administrativos</h4>
            <p>{{ total_administrativos }}</p>
        </div>
    </div>
</div>

{% for area in areas %}
<div class="area-card">
    <div class="area-header">
        <h3>{{ area.nombre }} ({{ area.num_empleados }} empleado{{ area.num_empleados|pluralize }})</h3>
    </div>
    <div class="area-content">
        {% if area.empleados.all %}
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Documento</th>
                        <th>Nombre</th>
                        <th>Tipo</th>
                        <th>Oficina</th>
                    </tr>
                </thead>
                <tbody>
                    {% for empleado in area.empleados.all %}
                    <tr class="{{ empleado.tipo }}">
                        <td>{{ empleado.documento }}</td>
                        <td>{{ empleado.nombre }}</td>
                        <td>
                            {{ empleado.get_tipo_display }}
                            {% if empleado.tipo == 'profesor' %} ({{ empleado.get_tipo_profesor_display }}){% endif %}
                        </td>
                        <td>{{ empleado.oficina.codigo }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="no-empleados">
            <p>No hay empleados asignados a esta área.</p>
        </div>
        {% endif %}
    </div>
</div>
{% empty %}
<div class="no-empleados">
    <p>No hay áreas registradas.</p>
</div>
{% endfor %}
{% endblock %}